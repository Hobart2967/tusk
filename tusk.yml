---
args:
  fast:
    usage: Skip slow linters/tests
    type: bool
  linter_opts:
    usage: Ignore for now
    computed: |
      if test ${fast} = true; then
        echo '--fast'
      fi
    private: true

tasks:
  bootstrap:
    usage: Set up the app for first time use
    script:
      - run:
          - go get -u gopkg.in/alecthomas/gometalinter.v1
          - go get -u github.com/golang/dep/cmd/dep
          - dep ensure

  lint:
    usage: Run the linter
    script:
      - run:
          - gometalinter.v1 --vendor ${linter_opts} ./...

  test:
    usage: Run the linter and tests
    args:
      lint:
        usage: Run the linter with the tests
        default: true
        type: bool
    pre:
      - name: lint
        when:
          test:
            - ${lint} = true
    script:
      - run:
          - go test $(go list ./... | grep -v '/vendor/')
